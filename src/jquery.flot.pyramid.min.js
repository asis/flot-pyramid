//
// This is a plugin for drawing [population pyramids](http://en.wikipedia.org/wiki/Population_pyramid) with
// [flot](http://code.google.com/p/flot/).
//
// Ok, let's wrap everything in a warm, secure closure.
var FlotPyramid=function(){function o(a){for(var b=0,c=a.length;b<c;b+=1)a[b][0]=b}function n(a,b){var c,d;d=$.map(b,function(a){return a[1]}),c=$.map(a,function(a){return a[0]});return d.toString()==c.toString()}function m(a,b){return b.length==a.length}function l(b,c){if(!m(b,c)||!n(b,c))throw a}function k(a,b){var c,d;for(c=0,d=a.length;c<d;c+=1)b.push([c,a[c][0]])}function j(a,b){b.length==0?k(a,b):l(a,b),o(a)}function i(a){var c=a.pyramid.direction;if(c&&!c.match(/L|W|R|E/))throw b}function h(a,b){function g(a,b){return a.reduce(function(a,c,d,e){return b(a,c)})}var c,d=a.xaxes[0].max||0,e=b.data,f;i(b),f=e.map(function(a){return a[1]}),c=g(f,Math.max),a.xaxes[0].max=Math.max(c,d),a.xaxes[0].min=-a.xaxes[0].max}function g(a){return function(b,c){b=b<0?-b:b;return a?a(b,c):b}}function f(a,b,c){var d=[],e=c.points,f=(b.pyramid.direction||"R").match(/L|W/)?-1:1;for(var g=0,h=e.length;g<h;g+=c.format.length)d.push(e[g+1]*f),d.push(e[g]),d.push(e[g+2]);c.points=d}function e(a,b,c){b.data=$.extend(!0,[],b.data),j(b.data,a.pyramidYaxisTicks),h(a.getOptions(),b)}function d(a,b){a.pyramidYaxisTicks=[];if(b.series.pyramid&&b.series.pyramid.show){$.extend(b.series.bars,{show:!0,horizontal:!0,align:"center",barWidth:b.series.pyramid.barWidth||.6});var c=b.xaxes[b.series.xaxis-1||0];$.extend(c,{tickFormatter:g(c.tickFormatter)});var d=b.yaxes[b.series.yaxis-1||0];$.extend(d,{ticks:a.pyramidYaxisTicks}),a.hooks.processRawData.push(e),a.hooks.processDatapoints.push(f)}}function c(a){a.hooks.processOptions.push(d)}var a={plugin:"flot.pyramid",msg:"Invalid series for pyramid plot! The supplied data must have exactly the same labels!"},b={plugin:"flot.pyramid",msg:"Invalid direction specified for pyramid series. Use 'L' or 'W' for left, or 'R' or 'E' for right (default is right)"};return{init:c,InvalidDirection:b,InvalidData:a}}();(function(a){a.plot.plugins.push({init:FlotPyramid.init,name:"pyramid",version:"1.0.1"})})(jQuery)