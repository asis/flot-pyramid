//
// This is a plugin for drawing [population pyramids](http://en.wikipedia.org/wiki/Population_pyramid) with
// [flot](http://code.google.com/p/flot/).
//
// Ok, let's wrap everything in a warm, secure closure.
var FlotPyramid=function(){function p(a){for(var b=0,c=a.length;b<c;b+=1)a[b][0]=b}function o(b){var c,d;d=$.map(a,function(a){return a[1]}),c=$.map(b,function(a){return a[0]});return d.toString()==c.toString()}function n(b){return a.length==b.length}function m(a){if(!n(a)||!o(a))throw b}function l(b){var c,d;for(c=0,d=b.length;c<d;c+=1)a.push([c,b[c][0]])}function k(b){a.length==0?l(b):m(b),p(b)}function j(a){var b=a.pyramid.direction;if(b&&!b.match(/L|W|R|E/))throw c}function i(a,b){function g(a,b){return a.reduce(function(a,c,d,e){return b(a,c)})}var c,d=a.xaxes[0].max||0,e=b.data,f;j(b),f=e.map(function(a){return a[1]}),c=g(f,Math.max),a.xaxes[0].max=Math.max(c,d),a.xaxes[0].min=-a.xaxes[0].max}function h(a){return function(b,c){b=b<0?-b:b;return a?a(b,c):b}}function g(a,b,c){var d=[],e=c.points,f=(b.pyramid.direction||"R").match(/L|W/)?-1:1;for(var g=0,h=e.length;g<h;g+=c.format.length)d.push(e[g+1]*f),d.push(e[g]),d.push(e[g+2]);c.points=d}function f(a,b,c){b.data=$.extend(!0,[],b.data),k(b.data),i(a.getOptions(),b)}function e(b,c){if(c.series.pyramid&&c.series.pyramid.show){$.extend(c.series.bars,{show:!0,horizontal:!0,align:"center",barWidth:c.series.pyramid.barWidth||.6});var d=c.xaxes[c.series.xaxis-1||0];$.extend(d,{tickFormatter:h(d.tickFormatter)});var e=c.yaxes[c.series.yaxis-1||0];$.extend(e,{ticks:a}),b.hooks.processRawData.push(f),b.hooks.processDatapoints.push(g)}}function d(a){a.hooks.processOptions.push(e)}var a=[],b={plugin:"flot.pyramid",msg:"Invalid series for pyramid plot! The supplied data must have exactly the same labels!"},c={plugin:"flot.pyramid",msg:"Invalid direction specified for pyramid series. Use 'L' or 'W' for left, or 'R' or 'E' for right (default is right)"};return{init:d,InvalidDirection:c,InvalidData:b}}();(function(a){a.plot.plugins.push({init:FlotPyramid.init,name:"pyramid",version:"1.0.0"})})(jQuery)